<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Consulta RUC</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { max-width: 600px; margin: 0 auto; }
        input { padding: 10px; margin: 5px; width: 200px; }
        button { padding: 10px 15px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
        .result { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 4px; background: #f9f9f9; }
        .success { color: green; background-color: #d4edda; border: 1px solid #c3e6cb; padding: 10px; border-radius: 4px; margin: 10px 0; }
        .warning { color: #856404; background-color: #fff3cd; border: 1px solid #ffeaa7; padding: 10px; border-radius: 4px; margin: 10px 0; }
        .error { color: red; background-color: #f8d7da; border: 1px solid #f5c6cb; padding: 10px; border-radius: 4px; margin: 10px 0; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Test Consulta RUC - SUNAT</h1>
        
        <div>
            <label>RUC a consultar:</label><br>
            <input type="text" id="rucInput" placeholder="20100070970" maxlength="11">
            <button onclick="testConsultaRuc()">üîç Consultar</button>
        </div>
        
        <div id="mensaje"></div>
        
        <div class="result">
            <h3>üìä Datos obtenidos:</h3>
            <div id="resultado"></div>
        </div>
        
        <div class="result">
            <h3>üîß Log de depuraci√≥n:</h3>
            <div id="debug" style="background: #1e1e1e; color: #fff; padding: 10px; border-radius: 4px; font-family: monospace; font-size: 12px; max-height: 300px; overflow-y: auto;"></div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8080/api';
        
        function log(mensaje) {
            const debugDiv = document.getElementById('debug');
            const timestamp = new Date().toLocaleTimeString();
            debugDiv.innerHTML += `[${timestamp}] ${mensaje}<br>`;
            debugDiv.scrollTop = debugDiv.scrollHeight;
            console.log(mensaje);
        }
        
        function mostrarMensaje(mensaje, tipo) {
            const elemento = document.getElementById('mensaje');
            const claseCSS = tipo === 'success' ? 'success' : tipo === 'warning' ? 'warning' : 'error';
            elemento.innerHTML = `<div class="${claseCSS}">${mensaje}</div>`;
        }
        
        async function testConsultaRuc() {
            const ruc = document.getElementById('rucInput').value.trim();
            const resultadoDiv = document.getElementById('resultado');
            
            log('=== INICIANDO TEST CONSULTA RUC ===');
            log(`RUC ingresado: ${ruc}`);
            
            // Limpiar resultados anteriores
            resultadoDiv.innerHTML = '';
            document.getElementById('debug').innerHTML = '';
            
            // Validar RUC
            if (!ruc || ruc.length !== 11 || !/^\d{11}$/.test(ruc)) {
                log('ERROR: RUC inv√°lido');
                mostrarMensaje('Por favor ingrese un RUC v√°lido de 11 d√≠gitos', 'error');
                return;
            }
            
            mostrarMensaje('üîç Consultando RUC en SUNAT...', 'warning');
            
            try {
                const url = `${API_BASE}/consulta-ruc/${ruc}`;
                log(`URL de consulta: ${url}`);
                
                const response = await fetch(url);
                log(`Status HTTP: ${response.status}`);
                log(`Status Text: ${response.statusText}`);
                
                if (response.ok) {
                    const result = await response.json();
                    log('=== RESPUESTA RECIBIDA ===');
                    log(`Success: ${result.success}`);
                    log(`Message: ${result.message}`);
                    log(`Data: ${JSON.stringify(result.data, null, 2)}`);
                    
                    if (result.success && result.data) {
                        const data = result.data;
                        
                        // Mostrar datos en HTML
                        resultadoDiv.innerHTML = `
                            <strong>RUC:</strong> ${data.ruc}<br>
                            <strong>Raz√≥n Social:</strong> ${data.razonSocial}<br>
                            <strong>Nombre Comercial:</strong> ${data.nombreComercial || 'N/A'}<br>
                            <strong>Estado:</strong> ${data.estado}<br>
                            <strong>Condici√≥n:</strong> ${data.condicion}<br>
                            <strong>Direcci√≥n:</strong> ${data.direccion || 'N/A'}<br>
                            <strong>Departamento:</strong> ${data.departamento || 'N/A'}<br>
                            <strong>Provincia:</strong> ${data.provincia || 'N/A'}<br>
                            <strong>Distrito:</strong> ${data.distrito || 'N/A'}<br>
                            <strong>Ubigeo:</strong> ${data.ubigeo || 'N/A'}
                        `;
                        
                        mostrarMensaje(`‚úÖ Datos encontrados: ${data.razonSocial} - Estado: ${data.estado}`, 'success');
                        log('=== CONSULTA EXITOSA ===');
                    } else {
                        log('=== SIN DATOS O ERROR EN RESPUESTA ===');
                        resultadoDiv.innerHTML = '<em>No se encontraron datos</em>';
                        mostrarMensaje(`‚ö†Ô∏è ${result.message || 'RUC no encontrado'}`, 'warning');
                    }
                } else {
                    log('=== ERROR HTTP ===');
                    const errorText = await response.text();
                    log(`Error text: ${errorText}`);
                    throw new Error(`Error ${response.status}: ${response.statusText}`);
                }
            } catch (error) {
                log('=== ERROR EN CATCH ===');
                log(`Error: ${error.message}`);
                log(`Stack: ${error.stack}`);
                resultadoDiv.innerHTML = '<em style="color: red;">Error en la consulta</em>';
                mostrarMensaje(`‚ùå Error: ${error.message}`, 'error');
            }
        }
        
        // Autocompletar con RUC de prueba al cargar
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('rucInput').value = '20100070970';
            log('üöÄ P√°gina de test cargada');
            log('‚úÖ RUC de prueba autocompletado: 20100070970 (Rimac Seguros)');
        });
    </script>
</body>
</html>