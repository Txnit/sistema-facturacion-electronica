<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Simple - Sistema Facturaci√≥n</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .form-group { margin-bottom: 10px; }
        label { display: block; margin-bottom: 5px; }
        input, select, button { padding: 8px; margin: 5px; }
        .error { color: red; background: #ffe6e6; padding: 10px; margin: 10px 0; }
        .success { color: green; background: #e6ffe6; padding: 10px; margin: 10px 0; }
        .debug { background: #f0f0f0; padding: 10px; margin: 10px 0; font-family: monospace; }
    </style>
</head>
<body>
    <h1>üß™ Test Simple - Sistema de Facturaci√≥n</h1>
    
    <div id="debug-info" class="debug">
        <h3>Debug Info:</h3>
        <div>API Base: <span id="api-base-display"></span></div>
        <div>Estado API: <span id="api-status">Comprobando...</span></div>
    </div>

    <h2>Test 1: Crear Cliente Simple</h2>
    <form onsubmit="crearClienteSimple(event)">
        <div class="form-group">
            <label>Tipo Documento:</label>
            <select id="tipoDoc" required>
                <option value="6">6 - RUC</option>
                <option value="1">1 - DNI</option>
            </select>
        </div>
        
        <div class="form-group">
            <label>N√∫mero:</label>
            <input type="text" id="numDoc" value="20123456789" required>
        </div>
        
        <div class="form-group">
            <label>Raz√≥n Social:</label>
            <input type="text" id="razonSocial" value="EMPRESA TEST SAC" required>
        </div>
        
        <div class="form-group">
            <label>Email:</label>
            <input type="email" id="email" value="test@empresa.com" required>
        </div>
        
        <button type="submit">‚úÖ Crear Cliente</button>
        <button type="button" onclick="testConexion()">üîç Test Conexi√≥n</button>
        <button type="button" onclick="listarClientesSimple()">üìã Listar Clientes</button>
    </form>

    <div id="resultado"></div>

    <h2>Test 2: API Directa</h2>
    <button onclick="testAPIDirecta()">üöÄ Test API /api/clientes</button>
    
    <div id="resultado-api"></div>

    <script>
        const API_BASE = '/api';
        
        // Mostrar info de debug
        document.getElementById('api-base-display').textContent = API_BASE;
        
        // Test de conexi√≥n al cargar
        window.onload = function() {
            console.log('P√°gina cargada');
            testConexion();
        };

        async function testConexion() {
            console.log('üîç Iniciando test de conexi√≥n...');
            const statusElement = document.getElementById('api-status');
            
            try {
                const url = `${API_BASE}/clientes`;
                console.log('URL de test:', url);
                
                const response = await fetch(url);
                console.log('Response status:', response.status);
                console.log('Response ok:', response.ok);
                
                if (response.ok) {
                    const data = await response.json();
                    console.log('Datos recibidos:', data);
                    statusElement.textContent = `‚úÖ Conectado (${data.length} clientes)`;
                    statusElement.style.color = 'green';
                } else {
                    statusElement.textContent = `‚ùå Error ${response.status}`;
                    statusElement.style.color = 'red';
                }
            } catch (error) {
                console.error('Error en test de conexi√≥n:', error);
                statusElement.textContent = `‚ùå Error: ${error.message}`;
                statusElement.style.color = 'red';
            }
        }

        async function crearClienteSimple(event) {
            event.preventDefault();
            console.log('üöÄ Iniciando creaci√≥n de cliente...');
            
            const cliente = {
                tipoDocumento: document.getElementById('tipoDoc').value,
                numeroDocumento: document.getElementById('numDoc').value,
                razonSocial: document.getElementById('razonSocial').value,
                nombreComercial: document.getElementById('razonSocial').value,
                email: document.getElementById('email').value,
                direccion: 'Direcci√≥n de prueba',
                telefono: '999888777',
                distrito: 'Lima',
                provincia: 'Lima',
                departamento: 'Lima',
                ubigeo: '150101',
                activo: true
            };

            console.log('Datos del cliente:', cliente);

            try {
                const url = `${API_BASE}/clientes`;
                console.log('URL de creaci√≥n:', url);
                
                const response = await fetch(url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify(cliente)
                });

                console.log('Response status:', response.status);
                console.log('Response headers:', [...response.headers.entries()]);

                const resultDiv = document.getElementById('resultado');

                if (response.ok) {
                    const result = await response.json();
                    console.log('Cliente creado:', result);
                    resultDiv.innerHTML = `<div class="success">‚úÖ Cliente creado exitosamente:<br>ID: ${result.id}<br>Nombre: ${result.razonSocial}</div>`;
                } else {
                    const errorText = await response.text();
                    console.error('Error del servidor:', errorText);
                    resultDiv.innerHTML = `<div class="error">‚ùå Error ${response.status}: ${errorText}</div>`;
                }
            } catch (error) {
                console.error('Error completo:', error);
                document.getElementById('resultado').innerHTML = `<div class="error">‚ùå Error de conexi√≥n: ${error.message}</div>`;
            }
        }

        async function listarClientesSimple() {
            console.log('üìã Listando clientes...');
            
            try {
                const response = await fetch(`${API_BASE}/clientes`);
                const clientes = await response.json();
                
                console.log('Clientes encontrados:', clientes);
                
                let html = '<div class="success"><h4>üìã Clientes encontrados:</h4>';
                if (clientes.length === 0) {
                    html += '<p>No hay clientes registrados</p>';
                } else {
                    clientes.forEach(cliente => {
                        html += `<p><strong>${cliente.razonSocial}</strong> (${cliente.numeroDocumento}) - ${cliente.email}</p>`;
                    });
                }
                html += '</div>';
                
                document.getElementById('resultado').innerHTML = html;
            } catch (error) {
                console.error('Error listando clientes:', error);
                document.getElementById('resultado').innerHTML = `<div class="error">‚ùå Error: ${error.message}</div>`;
            }
        }

        async function testAPIDirecta() {
            console.log('üöÄ Test API directa...');
            
            try {
                // Test GET
                const getResponse = await fetch(`${API_BASE}/clientes`);
                console.log('GET Response:', getResponse.status, getResponse.ok);
                
                // Test POST con datos m√≠nimos
                const testCliente = {
                    tipoDocumento: "1",
                    numeroDocumento: "12345678",
                    razonSocial: "TEST API",
                    email: "test@api.com",
                    activo: true
                };

                const postResponse = await fetch(`${API_BASE}/clientes`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(testCliente)
                });

                console.log('POST Response:', postResponse.status, postResponse.ok);
                
                if (postResponse.ok) {
                    const result = await postResponse.json();
                    document.getElementById('resultado-api').innerHTML = 
                        `<div class="success">‚úÖ API funcionando correctamente<br>Cliente de prueba creado: ${result.razonSocial} (ID: ${result.id})</div>`;
                } else {
                    const errorText = await postResponse.text();
                    document.getElementById('resultado-api').innerHTML = 
                        `<div class="error">‚ùå Error en POST: ${postResponse.status} - ${errorText}</div>`;
                }
                
            } catch (error) {
                console.error('Error en test API:', error);
                document.getElementById('resultado-api').innerHTML = 
                    `<div class="error">‚ùå Error de conexi√≥n: ${error.message}</div>`;
            }
        }
    </script>
</body>
</html>